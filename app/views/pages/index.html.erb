
<div id="stations-container">
<% @stations.each do |station| %>
<ul>
<%= render :partial => 'shared/station', :object => station %>
<%= render :partial => 'shared/arrival', :collection => station.arrivals %>
<%= render :partial => 'shared/no-arrivals' if station.arrivals.count <= 0 %>
</ul>
<% end %>
</div>

<%= render :partial => 'shared/testing' %>

<script>

	$(function() {
		setTimeout(updateArrivals, 3000);
		<% if false #use_location? %>
		setTimeout(checkLocationChange, 10000);
		<% end %>
	})
	
	function updateArrivals() {
		$('#stations-container').load(window.location.pathname + '?uid=' + (new Date()).getTime() + ' #stations-container ul', function() {
			setTimeout(updateArrivals, 3000);
		});
	}
	
	<% if false #use_location? %>
	function change_location(position) {
		if (((position.coords.latitude != <%= session[:loc][0] %>) || (position.coords.longitude != <%= session[:loc][1] %>))) {
			/*console.log(position.coords.accuracy);
			console.log(position.coords.latitude);
			console.log(<%= session[:loc][0] %>);
			console.log(position.coords.longitude);
			console.log(<%= session[:loc][1] %>);*/
			$('#debug').html(position.coords.accuracy + " :: " + position.coords.latitude + '//<%= session[:loc][0] %> -- ' + position.coords.longitude + '//<%= session[:loc][1] %>');
			$('.geo-location').addClass('active').attr('title', 'Your location has changed. Search for new stations near your new location?');
		}
		setTimeout(checkLocationChange, 10000);
		//window.location.href = '/?lat=' + position.coords.latitude + '&lng=' + position.coords.longitude + '&accuracy=' + position.coords.accuracy;
	}

	function checkLocationChange() {
		if (geo_position_js.init()) {
		  geo_position_js.getCurrentPosition(change_location, geo_error);
		}
		return false;
	};
	<% end %>

</script>
